<!DOCTYPE html>
<html lang="en">
<!--
Copyright 2012 Gary R. Van Sickle (grvs@users.sourceforge.net).

This file is part of CoFlo.

CoFlo is free software: you can redistribute it and/or modify it under the
terms of version 3 of the GNU General Public License as published by the Free
Software Foundation.

CoFlo is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU General Public License for more details.
 
You should have received a copy of the GNU General Public License along with
CoFlo.  If not, see http://www.gnu.org/licenses/.
-->
<head>
	<meta charset="utf-8">
	
	<!-- The date the report was generated (must be GMT in RFC 1123 format). -->
	<meta http-equiv="date" content="Mon, 24 Jun 2012 12:34:56 GMT">

	<title>Insert title here</title>

	<!-- <link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.9.0.custom.min.css"> -->
	<!-- The jQuery UI stylesheet. -->
	<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css">
	
	<!-- The jQuery UI Layout Plug-in's default stylesheet. -->
	<link rel="stylesheet" type="text/css" href="css/layout-default-latest.css">
	
	<!-- CoFlo's stylesheet. -->
	<link rel="stylesheet" type="text/css" href="css/index.template.css">
	
	
	<!-- SCRIPTS -->
	<!-- CoFlo's main support script. -->
	<script src="js/coflo/coflo-report.js"></script>
	<!-- 
	@todo Put this or something like it back when we use local copies of these libraries.
	<script src="js/jquery-1.8.2.js"></script>
	<script src="js/jquery-ui-1.9.0.custom.min.js"></script>
	-->
	<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
	<script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>
	<script src="js/jquery.layout-latest.js"></script>
	<script src="js/jstree_pre1.0_fix_1/jquery.jstree.js"></script>
	<script src="js/coflo.resizer.js"></script>
	<script>
	$(document).ready(function() {
		
		// The layout object.
		var mainLayout;
		var center_pane_resize_callback;
		var center_pane_tabs;
		
		/**
		 * Event handler callback for fitting the svg to the tab control when a new tab is selected.
		 */
		function onTabsActivate(event, ui)
		{
			// Get the svg <object>, wrapped in a jQuery object, which is contained in this tab panel.
			var svg = ui.newPanel.find(".svg-cfg");
			
			// Fit it to its container.
			fitToContainer(svg, ui.newPanel);
			
			console.log( "Tab Activated, tab:" +  $( "#tabs" ).tabs("option", "active") + "\n" );
		}
		
		function onTabsLoad(event, ui)
		{
			// Get the svg <object>, wrapped in a jQuery object, which is contained in this tab panel.
			var svg = ui.panel.find(".svg-cfg");
			
			// Fit it to its container.
			fitToContainer(svg, ui.panel);
			
			console.log( "Tab Loaded, tab:" +  $( "#tabs" ).tabs("option", "active") + "\n" );
		}
		
		// First hook the onTabsActivate callback to them, so the initially-shown tab is resized if necessary.
		//$( "#tabs" ).bind("tabsactivate", onTabsActivate);

		/// Initialize the tabs.
		center_pane_tabs = $( "#tabs" ).tabs({
			activate: onTabsActivate,
			create: onTabsLoad
		});
		
		// Set up the nav pane's tree control.
		var nav_tree = $("#nav_tree_id").jstree({
			"types" : {
				"valid_children" : [ "source_file" ],
				"types" : {
					"source_file" : {
						"valid_children" : [ "function" ]
					},
				"function" : {
						"valid_children" : [ "none" ]
					},
				"default" : {
	                    "valid_children" : [ "default" ]
					}
				},
			},
			
			// Configuration for jsTree's Themeroller support.
			themeroller :
				{
					// We'll use a "document" item for the files.
					item_open : "ui-icon-document",
					item_clsd : "ui-icon-document",
					
					// For functions, we'll use the gear icon.
					item_leaf : "ui-icon-gear"
				},
				
			// Docs say to list themeroller last.
			"plugins" : ["html_data", "ui", "types", "themeroller"],
			"core" : 
			{
				// Start with all files open.
				"initially_open" : [ "#nav_tree_file_1" ]
			}
		});
		
		// Bind to the nav tree's select event.
		nav_tree.bind("select_node.jstree", function (event, data) 
		{ 
            // `data.rslt.obj` is the jquery extended node that was clicked
            var selected_node = data.rslt.obj;
            
            // Get the href contained in the selected list item's <a> tag.
            var selected_function_id = $(selected_node).find("a").attr("href");
            console.info("href=" + selected_function_id);
            //$("#tabs").hide();

            // Create a copy of the new tab contents.
            // We have to do this or it will be deleted from the original DOM.
            var new_svg_pane_contents = $(selected_function_id).clone();
            // Strip off the <div>.
            //new_svg_pane_contents.unwrap();
            center_pane_tabs.find("#tabs-1").empty().html(new_svg_pane_contents.contents());
            center_pane_tabs.tabs("refresh");

            // Tell the center pane to resize its contents, mainly to cause the svg to be fit to the tab control.
            //mainLayout.sizeContent("center"); //.resizeContent("center");
            //mainLayout.resizeAll();
            
            console.info("Node selected: " + selected_node.attr("id"));
	    });

		/**
		 * Callback for handling the center pane's resize event.
		 * The main thing we have to do here is resize the svg.
		 */
		center_pane_resize_callback = function()
		{
			// Get the currently active tab panel.
			var active_tab_index = center_pane_tabs.tabs("option", "active");
			var active_tab_panel = center_pane_tabs.find(".ui-tabs-panel").eq(active_tab_index);
			
			// Get the svg <object>, wrapped in a jQuery object, which is contained in this tab panel.
			var svg = active_tab_panel.find(".svg-cfg");
			
			// Fit it to its container.
			fitToContainer(svg, active_tab_panel);
			
			console.info("center pane resized");
		};
		
		// Initialize the jQuery UI Layout Plug-in.
		mainLayout = $("body").layout({
			
			livePaneResizing: false,
			
			// We need this to allow natural resizing behavior with (at least) the svg's.
			// For some reason, when you're resizing, the cursor doesn't want to drag the resizer when it
			// goes over an SVG.  Enabling this allows it to work as expected.
			maskIframesOnResize: true,
			
			// The header pane.
			north:
				{
					// Top pane can't be closed or resized.
					closable: false,
					resizable: false,
					size: "auto"
				},
				
			// Nav pane.
			west:
				{
					size: "auto"
				},
			
			// Center pane.
			center:
				{
					onresize: center_pane_resize_callback
				},
				
				// Start with the bottom and right panes closed.
				east__initClosed: true,
				south__initClosed:	true
			});
	});
	</script>
</head>

<body>

<!-- The Report Header -->
<div class="ui-layout-north">CoFlo Analysis</div>

<!-- The Navigation Pane -->
<div id="nav_tree_id" class="ui-layout-west">
<ul>
	<!-- REMOVE_START -->
	<li id="nav_tree_file_1" class="coflo-nav-tree-file">
		<a href="#">File 1</a>
		<ul>
			<li id="nav_tree_2" rel="function">
				<a href="#decode_switches">decode_switches()</a>
			</li>
			<li id="nav_tree_3" rel="function">
				<a href="#die">die()</a>
			</li>
		</ul>
	</li>
	<li id="nav_tree_file_2" class="coflo-nav-tree-file">
		<a href="#">File 2</a>
		<ul>
			<li id="nav_tree_5" rel="function">
				<a href="#">Function 3</a>
			</li>
			<li id="nav_tree_6" rel="function">
				<a href="#">Function 4</a>
			</li>
		</ul>
	</li>
	<!-- REMOVE_END -->
	
	<!-- NAV_START -->
	<!-- NAV_END -->
</ul>
</div>

<!-- The center pane's tab control -->
<div id="tabs" class="ui-tabs ui-layout-center">
	<ul>
		<!-- REMOVE_START -->
		<li><a href="#tabs-1">Control Flow Graph</a></li>
		<li><a href="#tabs-2">Source</a></li>
		<!-- REMOVE_END -->
		
		<!-- TAB_LIST_START -->
		<!-- TAB_LIST_END -->
	</ul>
	<!-- The tab panels are put in this special div which the layout plugin uses to keep the tabs from
	being considered part of the scrollable area -->
	<div class="ui-layout-content ui-widget-content ui-corner-bottom">
		<!-- REMOVE_START -->
		<div id="tabs-1">
			<!-- Surround the function name with an anchor in an attempt at having reasonable <noscript> nav fallback. -->
			<!-- <p><a id="decode_switches">decode_switches()</a></p> -->
			<object class="svg-cfg" type="image/svg+xml" data="decode_switches.svg"></object>
		</div>
		<div id="tabs-2">
			<p>Paragraph</p>
			<P>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</P>
		<P>Duis cursus. Maecenas ligula eros, blandit nec, pharetra at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent viverra justo vitae neque. Praesent blandit adipiscing velit. Suspendisse potenti. Donec mattis, pede vel pharetra blandit, magna ligula faucibus eros, id euismod lacus dolor eget odio. Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut sagittis. Donec nisi lectus, feugiat porttitor, tempor ac, tempor vitae, pede. Aenean vehicula velit eu tellus interdum rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus. Vivamus a libero vitae lectus hendrerit hendrerit.</P>
			<!-- <object class="svg-cfg" type="image/svg+xml" data="decode_switches.svg"></object> -->
		</div>
		<!-- REMOVE_END -->
	
		<!-- TAB_PANEL_LIST_START -->	
		<!-- TAB_PANEL_LIST_END -->
	</div>
</div>

<div class="ui-layout-east"></div>

<div class="ui-layout-south">Bottom Pane</div>

<!-- The svgs. -->
<div style="display:none">
<div id="decode_switches">
	<!-- Surround the function name with an anchor in an attempt at having reasonable <noscript> nav fallback. -->
	<p><a id="file1-decode_switches">decode_switches()</a></p>
	<object class="svg-cfg" type="image/svg+xml" data="decode_switches.svg"></object>
</div>
<div id="die">
	<!-- Surround the function name with an anchor in an attempt at having reasonable <noscript> nav fallback. -->
	<p><a id="file1-die">die()</a></p>
	<object class="svg-cfg" type="image/svg+xml" data="die.svg"></object>
</div>
</div>

</body>
</html>
